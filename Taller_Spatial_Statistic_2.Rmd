---
title: \textbf{Examen-Taller 1 Estadística Espacial}
subtitle:
author: "Jose Angel Urquijo Parra"
date: \today

output:
  pdf_document:
    includes:
      in_header:
        - Config.txt     # Configuracion de pie, encabezado y usepackge
  
---


```{r setup, include=FALSE}
# Configuración general
knitr::opts_chunk$set(
  comment = "",
  fig.align = "center",
  message = FALSE,
  warning = FALSE,
  eval = TRUE,
  echo = TRUE,
  include = TRUE
)

```


## 1) \textcolor{blue}{Teniendo en cuenta todo lo visto en la primera y segunda semana de clases responda de manera clara y concisa las siguientes preguntas.}


Para la denominada Ciencia de la Información Geogrífica. Responda falso o verdadero a lo
siguiente:

a) La Ciencia de la Información Geografica no es un conjunto de conocimientos sobre los cuales
se asientan los SIG.(\textcolor{red}{FALSO})

b) Todos los fenómenos tienen incidencia sobre un espacio físico.(\textcolor{red}{VERDADERO})

c) Un SIG se concibe  únicamente como un programa de diseño gráfico utilizado para crear imágenes y gráficos artísticos, sin relación con datos espaciales del mundo real.(\textcolor{red}{FALSO})


## 2) \textcolor{blue}{Explique con sus propias palabras que es un Varigrama, que es un Krigging, que es autocorrelación y su uso en la Geoestadística.}

Claro, con gusto te explico cada uno de estos conceptos y su aplicación en la geoestadística:

### Varigrama

Un **varigrama** es una herramienta que se usa para entender la variabilidad de los datos espaciales. Es un gráfico que muestra cómo cambia la variabilidad de una variable medida (por ejemplo, la concentración de un contaminante en el suelo) con la distancia entre puntos.


### Kriging

El **kriging** es un método estadístico utilizado para estimar el valor de una variable en un punto no medido basado en valores de puntos cercanos. Es una técnica de interpolación avanzada que utiliza el varigrama para estimar estos valores. 


### Autocorrelación

La **autocorrelación** se refiere a la relación entre los valores de una variable en diferentes ubicaciones. En el contexto espacial, mide si un valor en un punto está correlacionado con los valores en puntos cercanos. 

En geoestadística, la autocorrelación es crucial porque indica si hay patrones espaciales en los datos. Si los valores cercanos entre sí son similares, se dice que hay autocorrelación positiva. Si los valores cercanos son muy diferentes, hay autocorrelación negativa.

### Uso en Geoestadística

En la **geoestadística**, todos estos conceptos se utilizan para analizar y modelar datos espaciales de manera precisa. El varigrama ayuda a entender cómo varía una variable espacialmente, el kriging utiliza esta información para hacer estimaciones y predicciones en ubicaciones no muestreadas, y la autocorrelación proporciona información sobre la estructura y patrón de los datos espaciales. Juntos, estos conceptos permiten hacer análisis más sofisticados y tomar decisiones basadas en la variabilidad y estructura espacial de los datos.



## \textcolor{blue}{Datos de nc.sids disponible en R. Encuentre lo siguiente:}


### a) \textcolor{red}{Analice descriptivamente los datos.}


```{r}
library(spData)
library(dplyr)
library(ggplot2)
library(knitr)
```

\textcolor{purple}{información sobre nacimientos y muertes por Síndrome de Muerte Súbita del Lactante}

Los datos proporcionados contienen información sobre nacimientos y muertes por Síndrome de Muerte Súbita del Lactante (SID) en varios condados de Carolina del Norte durante los periodos 1974-78 y 1979-84.

Para el respectivo análisis geoestadistico de la base de datos nc.sids sera tenida en cuenta el número de Nacimientos por condados del estado de Carolina del Norte.


```{r}
data("nc.sids")

head(nc.sids)

```

Para el promedio de Nacimientos en el estado de Carolina del Norte es posible observar que, en promedio el número de nacimientos registrados ha sido de 4224 y posteriormente ha prensentado un maximo de 30757 en el periodo comprendido de los años 1979-84.

Ademas cabe resaltar que el número minimo de nacimientos regsitrados fue de 319.


```{r}
print(summary(nc.sids$BIR79))

```

### b) \textcolor{red}{Encuentre patrones y tendencias.}


La Tasa de Natalida transcurrida en los años comprendidos 1979-84 presentaron una disminución considerable; esto 

```{r}

ggplot(nc.sids, aes(x = BIR79)) +
  geom_density(color = "red", size = 1) +
  labs(title = "Distribución de la tasa de Natalida infantil",
       x = "Tasa de Natalida Infantil",
       y = "Densidad") +
  theme_minimal()

```

### c) \textcolor{red}{Realice el mapa.}


```{r}
library(tmap)
library(sf)
library(tigris)
library(viridis)
```


```{r}
# mapa de los condados de Carolina del Norte
counties <- counties(state = "NC", cb = TRUE)

# CRS de los condados sea EPSG:4326
counties <- st_transform(counties, crs = 4269)

# Formato espacial utilizando las columnas 'lon' y 'lat'
nc.sids_sf <- st_as_sf(nc.sids, coords = c("lon", "lat"), crs = 4269)

# Datos espaciales con el mapa de los condados
nc_map <- st_join(counties, nc.sids_sf)

# Condados con Natalida infantil por encima de 50
high_natal <- nc_map %>% filter(BIR79 > 10000)
```


Los condados con mayor número de nacimientos han sido cumberland, meckenlenburg, Guilford, onslow, gaston, wake, forshy, durham. Caso curioso es; un estudio diferente sugiere que meckenlenburg, Guilford y wake tambien son los que prensentan mayor número de mortalidad.

```{r}
tm_shape(nc_map) +
  tm_polygons(col = "BIR79", palette = viridis(5, direction = -1), title = "Natalidad Infantil", 
              style = "quantile", n = 5, 
              textNA = "No disponible", colorNA = "grey90",
              border.col = "black", border.alpha = 0.8) +
  tm_borders(col = "black", lwd = 1) +
  tm_layout(main.title = "Natalidad Infantil en Carolina del Norte",
            main.title.size = 1.5,
            legend.title.size = 1.2,
            legend.text.size = 0.8,
            legend.position = c("right", "bottom"),
            frame = FALSE,
            inner.margins = c(0.2, 0.005, 0.2, 0.25),
            fontfamily = "sans") +
  tm_shape(high_natal) +
  tm_text("NAME", size = 0.3, col = "white", 
          auto.placement = TRUE) +
  tm_compass(type = "rose", position = c("right", "top")) +
  tm_scale_bar(position = c("left", "bottom"))

```


### d) \textcolor{red}{Encuentre: modelo de varianza.}

Para La varianza obtenida las distancias observadas del variograma sugieren que la varianza disminuyo considerablemente para este periodo de tiempo en el caso del número de Nacimientos por condados.

```{r}
library(gstat)
library(sp)

# Cálculo del variograma
variograma <- variogram(log(BIR79) ~ 1, data = nc.sids, locations = ~x+y)
plot(variograma)

```

### e) \textcolor{red}{Realice las predicciones correspondientes.}

De acuerdo a la transformación logarítmica ajustada a la relación entre la natalida y mortalida es posible observar que la relación es directamente proporcional; mientras una aumenta igual lo hace la otra. Con este modelo se puede corroborar la premisa de que los condados meckenlenburg, Guilford y wake son los que presentan mayor número de nacimientos pero a su vez tambien son aquellos donde se puede evidenciar un número de muertes considerablemente alto paara ese periodo.


```{r}
# Modelo lineal con la transformación logarítmica 
Nan <- lm(log(BIR79) ~ SID79, data = nc.sids)

# Mostrar el resumen del modelo ajustado
summary(Nan)
```


```{r}
# Crear el gráfico
ggplot(nc.sids, aes(x = BIR79, y = SID79)) +
  geom_point(alpha = 0.5, color = "blue") +  # Puntos de datos
  geom_smooth(method = "lm", formula = y ~ x, color = "purple", size = 1) +  # Línea de ajuste
  scale_x_log10(labels = scales::comma) +  # Aplicar escala logarítmica al eje x
  labs(title = "Relación entre Natalidad y Mortalidad",
       x = "Natalidad",
       y = "Mortalida") +
  theme_minimal()

```

### \textcolor{blue}{ Kriging(técnica de Interpolación)}

```{r, eval=FALSE}

# Cargar las librerías necesarias
library(gstat)
library(sp)

# Convertir a SpatialPixelsDataFrame
nc.sids_sf <- st_as_sf(nc.sids, coords = c("lon", "lat"), crs = 4269)

# Definir el variograma
ajuste <- variogram(log(BIR79 + 1) ~ 1, nc.sids_sf)

# Ajustar el variograma a los datos
model_fit <- fit.variogram(variogram(ajuste, vgm(1, "Sph", 300, 1))
                           
nc_sids_grid <- st_make_grid(nc.sids_sf, n = c(100, 100), what = "centers")

                           
kriging_result <- krige(log(BIR79 + 1) ~ 1, as(nc_sids_sf, "Spatial"), as(nc_sids_grid, "Spatial"), model = model_fit)

# Visualización de los resultados de Kriging
spplot(kriging_result["var1.pred"])




```



### f) \textcolor{red}{Existe Autocorrelación Espacial?}

En el caso de la autocorrelación espacial, el test de morant sugiere para la tasa de natalidad  las siguietes dos hipotesis:

H0: No hay Autocorrelación Espacial
H1: Hay Autocorrelación Espacial

De acuerdo al indice de morant el p-valor obtenido pierde con el alpha, por tanto \textcolor{red}{hay autocorrelación} para la natalidad.


```{r}
library(spdep)
# Crear una matriz de vecinos espaciales basada en la cercanía
nb <- knn2nb(knearneigh(coordinates(nc.sids), k = 4))

# pesos espaciales
lw <- nb2listw(nb, style = "W")

# índice de Moran para la concentración de zinc
moran_test <- moran.test(nc.sids$BIR79, lw)

moran_test


```












